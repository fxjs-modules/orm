<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>@fxjs/sql-query | FxJS ORM</title>
    <meta name="description" content="最好用的 FibJS ORM 框架">
    <link rel="stylesheet" href="/orm/assets/style.2853df4f.css">
    <link rel="modulepreload" href="/orm/assets/plugin-vue_export-helper.356b96c4.js">
    <link rel="modulepreload" href="/orm/assets/Home.995fdb91.js">
    <link rel="modulepreload" href="/orm/assets/orm-packages_sql-query.md.4a46baff.lean.js">
    <link rel="modulepreload" href="/orm/assets/app.4e37bee8.js">
    
    <meta name="twitter:title" content="@fxjs/sql-query | FxJS ORM">
  <meta property="og:title" content="@fxjs/sql-query | FxJS ORM">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/orm/" aria-label="FxJS ORM, back to home" data-v-40587210 data-v-016a8bd8><!----> FxJS ORM</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/orm/orm/getting-started" data-v-49fe041d>ORM <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/orm/clis/orm" data-v-49fe041d>CLI <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/fxjs-modules/orm" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/orm/orm/getting-started" data-v-49fe041d>ORM <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/orm/clis/orm" data-v-49fe041d>CLI <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/fxjs-modules/orm" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm/getting-started">开始连接</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/">Packages</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/orm-core">orm-core</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/db-driver">db-driver</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/knex">knex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/orm/orm-packages/sql-query">sql-query</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#快速开始">快速开始</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query">Query</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#new-query-query-opts-object">new Query::Query(opts: object)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-knex-readonly">Query::knex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-dialect-readonly">Query::Dialect</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-escape-sql-args">Query::escape(sql, args)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-escapeid-els">Query::escapeId(...els)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-escapeval-val-timezone">Query::escapeVal(val, timezone?)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-create">Query::create()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-select">Query::select()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-insert">Query::insert()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-update">Query::update()</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#query-remove">Query::remove()</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#comparators">comparators</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/sql-ddl-sync">sql-ddl-sync</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="fxjs-sql-query-wip" tabindex="-1"><code>@fxjs/sql-query</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->WIP<!--]--></span> <a class="header-anchor" href="#fxjs-sql-query-wip" aria-hidden="true">#</a></h1><p><a href="https://www.npmjs.org/package/@fxjs/sql-query" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/@fxjs/sql-query.svg" alt="NPM version"></a>  <a href="https://www.npmjs.org/package/@fxjs/sql-query" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dt/@fxjs/sql-query.svg" alt="NPM download"></a>  <a href="https://www.npmjs.org/package/@fxjs/sql-query" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dm/@fxjs/sql-query.svg" alt="NPM download monthly"></a></p><p><code>sql-query</code>, 用于生成可完成特定操作的 query sql, 是一个纯粹的字符串拼接工具. 它提供的能力可以帮助开发者简化 SQL 流程:</p><ul><li>基于 <code>Query</code> 对象, 对 SQL 语句, SQL Identifier, SQL Value 进行 escape</li><li>基于 <code>Query</code> 对象, 提供了链式构造器(ChainBuilder), 以生成满足基本交互需求的语句 <ul><li><code>create</code>: 生成一个 table</li><li><code>select</code>: 从 table 中查询数据</li><li><code>insert</code>: 向 table 中插入数据</li><li><code>update</code>: 更新 table 中的数据</li><li><code>remove</code>: 按照一定的条件删除 table 中的数据</li></ul></li><li><code>Query</code> 上的 <a href="./knex.html">knex</a> 对象, 满足开发者灵活的定制 SQL 需求</li></ul><p>支持的数据库 dialect 有:</p><ul><li><code>mysql</code></li><li><code>sqlite</code></li><li><code>postgresql</code></li></ul><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-hidden="true">#</a></h2><p>使用 <code>sql-query</code> 以构造用于生成名为 <code>table1</code> 表的 SQL.</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span>   <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

query<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&#39;table1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fields</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">a_text</span><span class="token operator">:</span> <span class="token string">&#39;text&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; &quot;create table `table1` (`id` int unsigned not null auto_increment primary key, `a_text` text)&quot;</span>
</code></pre></div><h2 id="query" tabindex="-1">Query <a class="header-anchor" href="#query" aria-hidden="true">#</a></h2><h3 id="new-query-query-opts-object" tabindex="-1"><code>new Query::Query(opts: object)</code> <a class="header-anchor" href="#new-query-query-opts-object" aria-hidden="true">#</a></h3><ul><li><code>opts.dialect</code>: (required) 目标数据库类型, 支持 <code>mysql</code>, <code>sqlite</code>, <code>postgresql</code>. </li></ul><h3 id="query-knex-readonly" tabindex="-1"><code>Query::knex</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#query-knex-readonly" aria-hidden="true">#</a></h3><p>knex 的实例.</p><h3 id="query-dialect-readonly" tabindex="-1"><code>Query::Dialect</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#query-dialect-readonly" aria-hidden="true">#</a></h3><p>Dialect 的实例. Dialect 上包含了适用于特定数据库的 escape*, value 转换, 时区转换等功能. 想了解更多关于不同的 Dialect 的信息, 可参考测试用例:</p><ul><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-mysql.js" target="_blank" rel="noopener noreferrer">mysql</a></li><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-sqlite.js" target="_blank" rel="noopener noreferrer">sqlite</a></li><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-postgresql.js" target="_blank" rel="noopener noreferrer">postgresql</a></li></ul><h3 id="query-escape-sql-args" tabindex="-1"><code>Query::escape(sql, args)</code> <a class="header-anchor" href="#query-escape-sql-args" aria-hidden="true">#</a></h3><p><strong>signature</strong> <code>Query::escape(sql: string, values: any[])</code></p><p>转义 sql 语句中的占位符, 包括:</p><ul><li><code>?</code>, 当作 sql 中的 value 来转义</li><li><code>??</code>, 当作 sql 中的 identifier 来转义</li></ul><p>如下, 以 escape mysql 语句为例</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

query<span class="token punctuation">.</span><span class="token function">escape</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from ?? where user_id = ?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; &quot;select * from `user` where user_id = &#39;1&#39;&quot;</span>
</code></pre></div><h3 id="query-escapeid-els" tabindex="-1"><code>Query::escapeId(...els)</code> <a class="header-anchor" href="#query-escapeid-els" aria-hidden="true">#</a></h3><p><strong>signature</strong> <code>Query::escapeId(...els: (string | number)): string</code></p><p>将一系列 <code>eles</code> 按照 SQL identifier 转义处理后, 输出按照 <code>.</code> 聚合的字符串. <code>eles</code> 可以是一个字符串, 也可以是一个字符串数组.</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeId</span><span class="token punctuation">(</span><span class="token string">&#39;user.id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; `user.id`</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;sqlite&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeId</span><span class="token punctuation">(</span><span class="token string">&#39;user.id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; `user.id`</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeId</span><span class="token punctuation">(</span><span class="token string">&#39;user.id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; &quot;user&quot;.&quot;id&quot;</span>
</code></pre></div><h3 id="query-escapeval-val-timezone" tabindex="-1"><code>Query::escapeVal(val, timezone?)</code> <a class="header-anchor" href="#query-escapeval-val-timezone" aria-hidden="true">#</a></h3><p><strong>signature</strong> <code>Query::escapeVal(val: any, timezone?: string): string</code></p><p>将 <code>val</code> 按照 SQL value 转义处理后输出. 根据 <code>dialect</code> 的类型不同, 有不同的处理结果.</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; NULL</span>
<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; NULL</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;sqlite&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token function">BigInt</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; 12</span>

<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; NaN</span>

<span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token number">1378322111133</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> tzOffsetMillis <span class="token operator">=</span> <span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getTimezoneOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> tzOffsetMillis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; 2013-09-04 19:15:11.133</span>
<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;Z&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; &#39;2013-09-04T19:15:11.133Z&#39;</span>
<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;-0000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; &#39;2013-09-04T19:15:11.133Z&#39;</span>
<span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;postgresql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">escapeVal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;-0400&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// =&gt; &#39;2013-09-04T15:15:11.133Z&#39;</span>
</code></pre></div><p>关于不同的 dialect 的 <code>escapeVal</code> 处理示例, 可参考测试用例:</p><ul><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-mysql.js" target="_blank" rel="noopener noreferrer">mysql</a></li><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-sqlite.js" target="_blank" rel="noopener noreferrer">sqlite</a></li><li><a href="https://github.com/fxjs-modules/orm/blob/@fxjs/sql-query@0.8.1/packages/sql-query/test/integration/test-dialect-postgresql.js" target="_blank" rel="noopener noreferrer">postgresql</a></li></ul><p><strong>注意</strong> <code>timezone</code> 的含义根据不同的数据库, 处理亦有不同, 请参考相关测试用例.</p><h3 id="query-create" tabindex="-1"><code>Query::create()</code> <a class="header-anchor" href="#query-create" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chainBuilder <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&#39;table1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参考<a href="https://github.com/fxjs-modules/orm/blob/%40fxjs/sql-query%400.8.1/packages/sql-query/test/integration/test-create.js" target="_blank" rel="noopener noreferrer"><strong>测试用例</strong></a></p><h3 id="query-select" tabindex="-1"><code>Query::select()</code> <a class="header-anchor" href="#query-select" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chainBuilder <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参考<a href="https://github.com/fxjs-modules/orm/blob/%40fxjs/sql-query%400.8.1/packages/sql-query/test/integration/test-select.js" target="_blank" rel="noopener noreferrer"><strong>测试用例</strong></a></p><h3 id="query-insert" tabindex="-1"><code>Query::insert()</code> <a class="header-anchor" href="#query-insert" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chainBuilder <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&#39;table1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参考<a href="https://github.com/fxjs-modules/orm/blob/%40fxjs/sql-query%400.8.1/packages/sql-query/test/integration/test-insert.js" target="_blank" rel="noopener noreferrer"><strong>测试用例</strong></a></p><h3 id="query-update" tabindex="-1"><code>Query::update()</code> <a class="header-anchor" href="#query-update" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chainBuilder <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token string">&#39;table1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>参考<a href="https://github.com/fxjs-modules/orm/blob/%40fxjs/sql-query%400.8.1/packages/sql-query/test/integration/test-update.js" target="_blank" rel="noopener noreferrer"><strong>测试用例</strong></a></p><h3 id="query-remove" tabindex="-1"><code>Query::remove()</code> <a class="header-anchor" href="#query-remove" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Query <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@fxjs/query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">dialect</span><span class="token operator">:</span> <span class="token string">&#39;mysql&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> chainBuilder <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>signature</strong> <code>Query::remove()</code></p><p>参考<a href="https://github.com/fxjs-modules/orm/blob/%40fxjs/sql-query%400.8.1/packages/sql-query/test/integration/test-remove.js" target="_blank" rel="noopener noreferrer"><strong>测试用例</strong></a></p><h2 id="comparators" tabindex="-1">comparators <a class="header-anchor" href="#comparators" aria-hidden="true">#</a></h2><p>comparators 是在 query 中生成特定比较对象的 utils, 它包含以下比较操作:</p><ul><li><code>between</code></li><li><code>not_between</code></li><li><code>like</code></li><li><code>not_like</code></li><li><code>eq</code></li><li><code>ne</code></li><li><code>gt</code></li><li><code>gte</code></li><li><code>lt</code></li><li><code>lte</code></li><li><code>in</code></li><li><code>not_in</code></li></ul><p>(To be continued)</p></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><a class="link" href="https://github.com/fxjs-modules/orm/edit/master/docs/orm-packages/sql-query.md" target="_blank" rel="noopener noreferrer" data-v-55695e90>在 Github 上编辑此页 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-55695e90><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-5c96fb00><p class="last-updated" data-v-5c96fb00 data-v-30c3cbb4><span class="prefix" data-v-30c3cbb4>最近更新:</span><span class="datetime" data-v-30c3cbb4></span></p></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/orm/orm-packages/knex" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>knex</span></a></div><div class="next" data-v-e65a9748><a class="link" href="/orm/orm-packages/sql-ddl-sync" data-v-e65a9748><span class="text" data-v-e65a9748>sql-ddl-sync</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-e65a9748><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"clis_orm.md\":\"d9f8c9bb\",\"index.md\":\"fd1b8ee5\",\"orm-packages_db-driver.md\":\"ab0042bd\",\"orm-packages_index.md\":\"7668f5a2\",\"orm-packages_knex.md\":\"d045e8e8\",\"orm-packages_orm-core.md\":\"0a39f116\",\"orm-packages_sql-ddl-sync.md\":\"db0fe7de\",\"orm-packages_sql-query.md\":\"4a46baff\",\"orm_connect-db.md\":\"b8a88b95\",\"orm_getting-started.md\":\"072a49db\",\"orm_index.md\":\"035e10b5\",\"rfcs_0000-style.md\":\"97c0ddd2\"}")</script>
    <script type="module" async src="/orm/assets/app.4e37bee8.js"></script>
    
  </body>
</html>