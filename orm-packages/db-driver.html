<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>@fxjs/db-driver | FxJS ORM</title>
    <meta name="description" content="最好用的 FibJS ORM 框架">
    <link rel="stylesheet" href="/orm/assets/style.2853df4f.css">
    <link rel="modulepreload" href="/orm/assets/plugin-vue_export-helper.72096a39.js">
    <link rel="modulepreload" href="/orm/assets/Home.28c91c9d.js">
    <link rel="modulepreload" href="/orm/assets/orm-packages_db-driver.md.bb548432.lean.js">
    <link rel="modulepreload" href="/orm/assets/app.623ead43.js">
    
    <meta name="twitter:title" content="@fxjs/db-driver | FxJS ORM">
  <meta property="og:title" content="@fxjs/db-driver | FxJS ORM">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/orm/" aria-label="FxJS ORM, back to home" data-v-40587210 data-v-016a8bd8><!----> FxJS ORM</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/orm/orm/getting-started" data-v-49fe041d>ORM <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/orm/clis/orm" data-v-49fe041d>CLI <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/fxjs-modules/orm" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item active" href="/orm/orm/getting-started" data-v-49fe041d>ORM <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/orm/clis/orm" data-v-49fe041d>CLI <!----></a></div></div><!--]--><!----><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/fxjs-modules/orm" target="_blank" rel="noopener noreferrer" data-v-49fe041d>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm/getting-started">开始连接</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm/property">Property</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm/virtual-view">虚拟视图</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm/plugins">ORM 插件</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/">Packages</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/orm-core">orm-core</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/orm-property">orm-property</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/orm/orm-packages/db-driver">db-driver</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#支持的数据库类型">支持的数据库类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#快速开始">快速开始</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver">Driver</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-create-connection-string-object-driverinstance-static">Driver.create(connection: string | object): DriverInstance</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-formaturl-urlobj-object-string-static">Driver.formatUrl(urlObj: object): string</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-getdriver-type-string-driverconstructor-static">Driver.getDriver(type: string): DriverConstructor</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-uid-readonly">Driver::uid</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-uri-readonly">Driver::uri</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-type">Driver::type</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-config-readonly">Driver::config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-extend-config-readonly">Driver::extend_config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-connection-readonly">Driver::connection</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-ispool-readonly">Driver::isPool</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-issql-readonly">Driver::isSql</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-isnosql-readonly">Driver::isNoSql</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-iscommand-readonly">Driver::isCommand</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-open-void">Driver::open(): void</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-close-void">Driver::close(): void</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-reopen-void">Driver::reopen(): void</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-getconnection-t">Driver::getConnection(): T</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-connectionpool-callback-connection-conn-type-any-any">Driver::connectionPool(callback: (connection: CONN_TYPE) =&gt; any): any</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#driver-usetrans-callback-conn-for-trans-conn-type-any">Driver::useTrans(callback: (conn_for_trans: CONN_TYPE) =&gt; any)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#sqldriver">SQLDriver</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#sqldriver-switchdb-db-name">SQLDriver::switchDb(db: name)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#sqldriver-trans-cb-function-boolean">SQLDriver::trans(cb: Function): boolean</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#sqldriver-execute-sql-string-blocking">SQLDriver::execute(sql: string)</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#redisdriver">RedisDriver</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#redisdriver-command-cmd-string-arg-any-blocking">RedisDriver::command(cmd: string, arg: any)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#redisdriver-commands-cmds-record-string-any-opts-object-blocking">`RedisDriver::commands(cmds: Record</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodriver">MongoDriver</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodriver-command-cmd-string-arg-any-blocking">MongoDriver::command(cmd: string, arg: any)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mongodriver-commands-cmds-object-opts-object-blocking">MongoDriver::commands(cmds: object, opts: object)</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/knex">knex</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/sql-query">sql-query</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/orm/orm-packages/sql-ddl-sync">sql-ddl-sync</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="fxjs-db-driver" tabindex="-1"><code>@fxjs/db-driver</code> <a class="header-anchor" href="#fxjs-db-driver" aria-hidden="true">#</a></h1><p><a href="https://www.npmjs.org/package/@fxjs/db-driver" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/@fxjs/db-driver.svg" alt="NPM version"></a>  <a href="https://www.npmjs.org/package/@fxjs/db-driver" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dt/@fxjs/db-driver.svg" alt="NPM download"></a>  <a href="https://www.npmjs.org/package/@fxjs/db-driver" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dm/@fxjs/db-driver.svg" alt="NPM download monthly"></a></p><p>db-driver 提供了统一的接口 <code>Driver</code>, 用于操作数据库.</p><h2 id="支持的数据库类型" tabindex="-1">支持的数据库类型 <a class="header-anchor" href="#支持的数据库类型" aria-hidden="true">#</a></h2><p>目前 db-driver 支持的数据库类型有:</p><table><thead><tr><th>数据库</th><th>驱动类型标识</th><th>Driver 类型</th></tr></thead><tbody><tr><td>MySQL/MariaDB</td><td><code>mysql</code></td><td><code>SQLDriver</code> <code>MySQLDriver</code></td></tr><tr><td>PostgreSQL</td><td><code>postgresql</code></td><td><code>PostgreSQLDriver</code></td></tr><tr><td>SQLite</td><td><code>sqlite</code></td><td><code>SQLiteDriver</code></td></tr><tr><td>Redis</td><td><code>redis</code></td><td><code>RedisDriver</code></td></tr><tr><td>MongoDB</td><td><code>mongodb</code></td><td><code>MongoDBDriver</code></td></tr></tbody></table><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-hidden="true">#</a></h2><p>安装</p><div class="language-sh"><pre><code><span class="token function">npm</span> <span class="token function">install</span> @fxjs/db-driver
</code></pre></div><p>在 fibjs 中构造一个适用于 <code>mysql</code> 的 dbdriver</p><div class="language-js"><pre><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Driver <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@fxjs/db-driver&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// use connection string</span>
<span class="token keyword">var</span> driver <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:password@localhost:3306/mydb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// or use connection object</span>
<span class="token keyword">var</span> driver <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">&#39;mysql:&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hostname</span><span class="token operator">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">&#39;mydb&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// open connection</span>
driver<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// execute sql query</span>
driver<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">&#39;CREATE DATABASE IF NOT EXISTS mydb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// close connection</span>
driver<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// reopen connection, equivalent to `driver.close()` safely and then `driver.open()`</span>
driver<span class="token punctuation">.</span><span class="token function">reopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="driver" tabindex="-1"><code>Driver</code> <a class="header-anchor" href="#driver" aria-hidden="true">#</a></h2><h3 id="driver-create-connection-string-object-driverinstance-static" tabindex="-1"><code>Driver.create(connection: string | object): DriverInstance</code> <span class="badge badge-type-info" style="vertical-align:top;" data-v-cae86cf0><!--[-->static<!--]--></span> <a class="header-anchor" href="#driver-create-connection-string-object-driverinstance-static" aria-hidden="true">#</a></h3><p>根据传入数据库连接字符串, 或者数据库连接对象, 创建一个 <code>Driver</code> 实例. Driver 会根据传递的前缀, 自动选择对应的数据库类型.</p><div class="language-js"><pre><code><span class="token keyword">var</span> mydb <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> pgdb <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;psql://root:@localhost:5432&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pgdb <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;postgresql://root:@localhost:5432&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pgdb <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;pg://root:@localhost:5432&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> redisCmder <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;redis://127.0.0.1:6379&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> sqliteDB <span class="token operator">=</span>Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;sqlite:web.db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sqliteDB <span class="token operator">=</span>Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;sqlite:/var/www/web.db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="driver-formaturl-urlobj-object-string-static" tabindex="-1"><code>Driver.formatUrl(urlObj: object): string</code> <span class="badge badge-type-info" style="vertical-align:top;" data-v-cae86cf0><!--[-->static<!--]--></span> <a class="header-anchor" href="#driver-formaturl-urlobj-object-string-static" aria-hidden="true">#</a></h3><p>将一个对象格式化为数据库连接字符串.</p><div class="language-js"><pre><code>Driver<span class="token punctuation">.</span><span class="token function">formatURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">protocol</span> <span class="token operator">:</span> <span class="token string">&quot;mysql:&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hostname</span> <span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">username</span> <span class="token operator">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span>     <span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pathname</span> <span class="token operator">:</span> <span class="token string">&quot;/mydb&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">slashes</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// use `//` after protocol</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; &quot;mysql://root@localhost:3306/mydb&quot;</span>

Driver<span class="token punctuation">.</span><span class="token function">formatURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token string">&quot;sqlite:&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">&#39;web.db&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// =&gt; &quot;sqlite:web.db&quot;</span>
</code></pre></div><h3 id="driver-getdriver-type-string-driverconstructor-static" tabindex="-1"><code>Driver.getDriver(type: string): DriverConstructor</code> <span class="badge badge-type-info" style="vertical-align:top;" data-v-cae86cf0><!--[-->static<!--]--></span> <a class="header-anchor" href="#driver-getdriver-type-string-driverconstructor-static" aria-hidden="true">#</a></h3><p>根据传入 <code>type</code> 获取对应的 driver. <code>type</code> 可以是准确的驱动类型 <code>&#39;mysql&#39; | &#39;sqlite&#39; | &#39;psql&#39; | &#39;mssql&#39; | &#39;redis&#39; | &#39;mongodb&#39;</code></p><div class="language-js"><pre><code><span class="token comment">// return mysql driver</span>
Driver<span class="token punctuation">.</span><span class="token function">getDriver</span><span class="token punctuation">(</span><span class="token string">&#39;mysql&#39;</span><span class="token punctuation">)</span>
</code></pre></div><p>也可以是带有合法 protocol 前缀的字符串, 比如连接字符串. 当发现传入字符串不是准确的驱动类型时, 会尝试将其按 url 解析, 获得其 protocol 并以此取得对应的驱动类型.</p><div class="language-js"><pre><code><span class="token comment">// return mysql driver</span>
Driver<span class="token punctuation">.</span><span class="token function">getDriver</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://localhost:3306/mydb&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// return sqlite driver</span>
Driver<span class="token punctuation">.</span><span class="token function">getDriver</span><span class="token punctuation">(</span><span class="token string">&#39;sqlite:web.db&#39;</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="driver-uid-readonly" tabindex="-1"><code>Driver::uid</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-uid-readonly" aria-hidden="true">#</a></h3><p>Driver 实例创建时, 生成的唯一 id. 不可更改, 一般用于开发者内部 debug</p><h3 id="driver-uri-readonly" tabindex="-1"><code>Driver::uri</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-uri-readonly" aria-hidden="true">#</a></h3><p>当前 Driver 经过格式化的连接 uri.</p><p><strong>注意</strong> 格式化后的 uri 更规范, 不一定等于传入的 uri.</p><h3 id="driver-type" tabindex="-1"><code>Driver::type</code> <a class="header-anchor" href="#driver-type" aria-hidden="true">#</a></h3><p>当前 Driver 的驱动类型, 参考<a href="#%E6%94%AF%E6%8C%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B">驱动类型标识</a></p><h3 id="driver-config-readonly" tabindex="-1"><code>Driver::config</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-config-readonly" aria-hidden="true">#</a></h3><p>当前 Driver 的配置, 该配置是对 <code>new Driver(options)</code> 中 <code>options</code> 解析后的对象的<strong>快照</strong>.</p><p><strong>P.S.</strong> 这意味着你对 config 上字段的更改是没有意义的.</p><h3 id="driver-extend-config-readonly" tabindex="-1"><code>Driver::extend_config</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-extend-config-readonly" aria-hidden="true">#</a></h3><p>当前 Driver 的扩展配置, 扩展配置<strong>并非</strong>可以自由定义.</p><p>目前, 在创建实例 <code>new Driver(options)</code> 时, 会读取 <code>options.query[ext_conf_key]</code> 来获取一些 key-value 作为扩展配置.</p><ul><li><code>pool</code>: 是否使用连接池, 默认为 <code>false</code></li><li><code>debug</code>: 是否使用 debug 模式. 根据 query value 进行 coerce, <code>&#39;0&#39; | &#39;false&#39; | &#39;no&#39; | &#39;n&#39; | &#39;&#39; </code>表示 <code>false</code>, <code>&#39;1&#39; | &#39;true&#39; | &#39;y&#39;</code> 或其它非空值表示 <code>true</code>.</li></ul><p>举例说明:</p><div class="language-js"><pre><code><span class="token comment">// those db.extend_config.pool // =&gt; true</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?pool=1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?pool=aaa&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?pool=true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// those db.extend_config.debug // =&gt; true</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?debug=1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?debug=true&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// those db.extend_config.debug // =&gt; false</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?debug=0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?debug=no&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> db <span class="token operator">=</span> Driver<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;mysql://root:@localhost:3306/mydb?debug=false&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="driver-connection-readonly" tabindex="-1"><code>Driver::connection</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-connection-readonly" aria-hidden="true">#</a></h3><p>当前 driver 的实际连接对象, 可能是以下类型:</p><table><thead><tr><th>驱动类型</th><th>connection 类型</th><th>是否为 fibjs 原生对象</th></tr></thead><tbody><tr><td><code>mysql</code></td><td><code>Class_MySQL</code></td><td>Y</td></tr><tr><td><code>sqlite</code></td><td><code>Class_SQLite</code></td><td>Y</td></tr><tr><td><code>postgresql</code></td><td><code>Class_DbConnection</code></td><td>Y</td></tr><tr><td><code>mongodb</code></td><td><code>Class_MongoDB</code></td><td>Y</td></tr><tr><td><code>redis</code></td><td><code>Class_Redis</code></td><td>Y</td></tr></tbody></table><h3 id="driver-ispool-readonly" tabindex="-1"><code>Driver::isPool</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-ispool-readonly" aria-hidden="true">#</a></h3><p>当前 driver 是否使用连接池. 其值取决于 <code>Driver.extend_config.pool</code> 的值.</p><h3 id="driver-issql-readonly" tabindex="-1"><code>Driver::isSql</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-issql-readonly" aria-hidden="true">#</a></h3><p>当前 driver 是否属于 SQL 数据库的客户端, 如 <code>sqlite</code>, <code>mysql</code>, <code>postgresql</code>.</p><h3 id="driver-isnosql-readonly" tabindex="-1"><code>Driver::isNoSql</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-isnosql-readonly" aria-hidden="true">#</a></h3><p>当前 driver 是否属于 NoSQL 数据库的客户端, 如 <code>mongodb</code>.</p><h3 id="driver-iscommand-readonly" tabindex="-1"><code>Driver::isCommand</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->readonly<!--]--></span> <a class="header-anchor" href="#driver-iscommand-readonly" aria-hidden="true">#</a></h3><p>当前 driver 是否属于通过 command 方式和 server 交互的客户端, 如 <code>mongodb</code>, <code>redis</code>.</p><h3 id="driver-open-void" tabindex="-1"><code>Driver::open(): void</code> <a class="header-anchor" href="#driver-open-void" aria-hidden="true">#</a></h3><p>打开当前 driver 的连接, 打开后, 可以和数据库进行交互. 该方法内部依赖 <code>Driver::getConnection</code> 来获取连接对象.</p><h3 id="driver-close-void" tabindex="-1"><code>Driver::close(): void</code> <a class="header-anchor" href="#driver-close-void" aria-hidden="true">#</a></h3><p>关闭当前 driver 的连接, 关闭后, 不可以和数据库进行交互.</p><h3 id="driver-reopen-void" tabindex="-1"><code>Driver::reopen(): void</code> <a class="header-anchor" href="#driver-reopen-void" aria-hidden="true">#</a></h3><p><strong>安全地</strong>关闭当前 driver 的连接, 后并重新打开连接.</p><p>该方法可以在 driver 未开启时调用</p><h3 id="driver-getconnection-t" tabindex="-1"><code>Driver::getConnection(): T</code> <a class="header-anchor" href="#driver-getconnection-t" aria-hidden="true">#</a></h3><p>获取一个 driver 驱动类型的连接对象,</p><p><strong>注意</strong> 该方法的含义并不是「返回 driver 的 connection 对象」, 相对地, 该方法被调用往往是为了给 connection 对象赋值.</p><h3 id="driver-connectionpool-callback-connection-conn-type-any-any" tabindex="-1"><code>Driver::connectionPool(callback: (connection: CONN_TYPE) =&gt; any): any</code> <a class="header-anchor" href="#driver-connectionpool-callback-connection-conn-type-any-any" aria-hidden="true">#</a></h3><p>当 <code>this.isPool</code> 为真, 会从连接池中获取一个 <code>connection</code> 对象, 作为传输传入 <code>callback</code> 回调执行;</p><p>否则, 则会调用 <code>this.getConnection()</code> 获取一个 <code>connection</code> 对象, 作为传输传入 <code>callback</code> 回调执行.</p><h3 id="driver-usetrans-callback-conn-for-trans-conn-type-any" tabindex="-1"><code>Driver::useTrans(callback: (conn_for_trans: CONN_TYPE) =&gt; any)</code> <a class="header-anchor" href="#driver-usetrans-callback-conn-for-trans-conn-type-any" aria-hidden="true">#</a></h3><p>获取一个连接 <code>conn_for_trans</code>, 以事务的方式执行一个 <code>callback</code>.</p><h2 id="sqldriver" tabindex="-1"><code>SQLDriver</code> <a class="header-anchor" href="#sqldriver" aria-hidden="true">#</a></h2><p><strong>派生关系</strong> <code>class SQLDriver extends Driver</code></p><p><code>SQLDriver</code> 是针对 SQL 数据库的 Driver:</p><p>db-driver 支持以下 SQL 数据库:</p><ul><li><code>MySQLDriver</code>: <code>extends SQLDriver</code></li><li><code>PostgreSQLDriver</code>: <code>extends SQLDriver</code></li><li><code>SQLiteDriver</code>: <code>extends SQLDriver</code></li></ul><p>根据关系型数据库的特点, <code>SQLDriver</code> 在 <code>Driver</code> 的基础上扩展了接口定义. 并由其派生的子类实现具体的接口.</p><h3 id="sqldriver-switchdb-db-name" tabindex="-1"><code>SQLDriver::switchDb(db: name)</code> <a class="header-anchor" href="#sqldriver-switchdb-db-name" aria-hidden="true">#</a></h3><p>切换当前连接的数据库. 对于部分 SQL 数据库而言该方法没有意义, 比如 SQLite 连接后必然是单库模式.</p><h3 id="sqldriver-trans-cb-function-boolean" tabindex="-1"><code>SQLDriver::trans(cb: Function): boolean</code> <a class="header-anchor" href="#sqldriver-trans-cb-function-boolean" aria-hidden="true">#</a></h3><p>SQL 数据库一般都支持事务(Transaction),</p><p>你也可以使用独立的事务接口, 手动控制事务.</p><ul><li><code>SQLDriver::begin()</code></li><li><code>SQLDriver::commit()</code></li><li><code>SQLDriver::rollback()</code></li></ul><h3 id="sqldriver-execute-sql-string-blocking" tabindex="-1"><code>SQLDriver::execute(sql: string)</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->blocking<!--]--></span> <a class="header-anchor" href="#sqldriver-execute-sql-string-blocking" aria-hidden="true">#</a></h3><p>执行 sql 语句, 并返回执行结果.</p><p><strong>注意</strong> 该方法为阻塞方法, 仅支持唯一的参数 <code>sql</code>, 因此对 sql 语句的 escape 必须由调用者自行完成.</p><h2 id="redisdriver" tabindex="-1"><code>RedisDriver</code> <a class="header-anchor" href="#redisdriver" aria-hidden="true">#</a></h2><p><strong>派生关系</strong> <code>class RedisDriver extends Driver</code></p><h3 id="redisdriver-command-cmd-string-arg-any-blocking" tabindex="-1"><code>RedisDriver::command(cmd: string, arg: any)</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->blocking<!--]--></span> <a class="header-anchor" href="#redisdriver-command-cmd-string-arg-any-blocking" aria-hidden="true">#</a></h3><p>执行一个 redis cmd(cmd 参数为 arg), 并返回执行结果.</p><h3 id="redisdriver-commands-cmds-record-string-any-opts-object-blocking" tabindex="-1"><code>RedisDriver::commands(cmds: Record&lt;string, any&gt;, opts: object)</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->blocking<!--]--></span> <a class="header-anchor" href="#redisdriver-commands-cmds-record-string-any-opts-object-blocking" aria-hidden="true">#</a></h3><p>执行一组 redis cmds, 并返回执行结果.</p><p>cmds 结构:</p><div class="language-ts"><pre><code><span class="token keyword">interface</span> <span class="token class-name">IRedisCmds</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>cmd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token comment">/* arg */</span><span class="token builtin">any</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="mongodriver" tabindex="-1"><code>MongoDriver</code> <a class="header-anchor" href="#mongodriver" aria-hidden="true">#</a></h2><p><strong>派生关系</strong> <code>class MongoDriver extends Driver</code></p><h3 id="mongodriver-command-cmd-string-arg-any-blocking" tabindex="-1"><code>MongoDriver::command(cmd: string, arg: any)</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->blocking<!--]--></span> <a class="header-anchor" href="#mongodriver-command-cmd-string-arg-any-blocking" aria-hidden="true">#</a></h3><p>执行一个 mongodb cmd(cmd 参数为 arg), 并返回执行结果.</p><h3 id="mongodriver-commands-cmds-object-opts-object-blocking" tabindex="-1"><code>MongoDriver::commands(cmds: object, opts: object)</code> <span class="badge badge-type-warning" style="vertical-align:top;" data-v-cae86cf0><!--[-->blocking<!--]--></span> <a class="header-anchor" href="#mongodriver-commands-cmds-object-opts-object-blocking" aria-hidden="true">#</a></h3><p>执行一组 mongodb cmds, 并返回执行结果.</p><p>cmds 结构:</p><div class="language-ts"><pre><code><span class="token keyword">interface</span> <span class="token class-name">IMongoDBCmds</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>cmd<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token comment">/* arg */</span><span class="token builtin">any</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><a class="link" href="https://github.com/fxjs-modules/orm/edit/master/docs/orm-packages/db-driver.md" target="_blank" rel="noopener noreferrer" data-v-55695e90>在 Github 上编辑此页 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-55695e90><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-5c96fb00><p class="last-updated" data-v-5c96fb00 data-v-30c3cbb4><span class="prefix" data-v-30c3cbb4>最近更新:</span><span class="datetime" data-v-30c3cbb4></span></p></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/orm/orm-packages/orm-property" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>orm-property</span></a></div><div class="next" data-v-e65a9748><a class="link" href="/orm/orm-packages/knex" data-v-e65a9748><span class="text" data-v-e65a9748>knex</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-e65a9748><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"clis_orm.md\":\"5c6f0272\",\"index.md\":\"ab4e9892\",\"orm-packages_db-driver.md\":\"bb548432\",\"orm-packages_index.md\":\"294212c5\",\"orm-packages_knex.md\":\"543332a7\",\"orm-packages_orm-core.md\":\"1235b9da\",\"orm-packages_orm-property.md\":\"ef79f77c\",\"orm-packages_sql-ddl-sync.md\":\"1db18c37\",\"orm-packages_sql-query.md\":\"00dd5679\",\"orm_adapters.md\":\"4e55b0a5\",\"orm_connect-db.md\":\"8fbebe5f\",\"orm_getting-started.md\":\"9c0b2d8c\",\"orm_index.md\":\"ad4e4e9e\",\"orm_plugins.md\":\"c6027fb9\",\"orm_property.md\":\"c9346226\",\"orm_virtual-view.md\":\"7ac7848b\",\"rfcs_0000-style.md\":\"bf2a8fce\"}")</script>
    <script type="module" async src="/orm/assets/app.623ead43.js"></script>
    
  </body>
</html>