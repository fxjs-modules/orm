import{_ as e,y as o,D as a,O as t,V as p,B as n,X as c,T as l,x as r}from"./plugin-vue_export-helper.b4fda088.js";const q='{"title":"ORM CLI","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u7F6E\u8981\u6C42","slug":"\u524D\u7F6E\u8981\u6C42"},{"level":2,"title":"\u5FEB\u901F\u5F00\u59CB","slug":"\u5FEB\u901F\u5F00\u59CB"},{"level":2,"title":"universal \u547D\u4EE4","slug":"universal-\u547D\u4EE4"},{"level":3,"title":"upgrade","slug":"upgrade"},{"level":3,"title":"dumpModel","slug":"dumpmodel"}],"relativePath":"clis/orm.md","lastUpdated":1663579727772}',d={},i={id:"orm-cli-wip",tabindex:"-1"},u=n("ORM CLI "),k=n("WIP"),m=n(),h=a("a",{class:"header-anchor",href:"#orm-cli-wip","aria-hidden":"true"},"#",-1),g=c(`<p><code>orm-cli</code> \u547D\u4EE4\u662F\u7528\u4E8E\u5E2E\u52A9 orm \u5F00\u53D1\u8005\u8FDB\u884C\u6D4B\u8BD5\u5F00\u53D1\u7684 CLI \u5DE5\u5177.</p><h2 id="\u524D\u7F6E\u8981\u6C42" tabindex="-1">\u524D\u7F6E\u8981\u6C42 <a class="header-anchor" href="#\u524D\u7F6E\u8981\u6C42" aria-hidden="true">#</a></h2><ul><li>fibjs &gt;= 0.33.0</li></ul><h2 id="\u5FEB\u901F\u5F00\u59CB" tabindex="-1">\u5FEB\u901F\u5F00\u59CB <a class="header-anchor" href="#\u5FEB\u901F\u5F00\u59CB" aria-hidden="true">#</a></h2><div class="language-bash"><pre><code><span class="token function">npm</span> i <span class="token parameter variable">-g</span> @fxjs/orm-cli
</code></pre></div><p>\u4F7F\u5F97 <code>orm</code> \u547D\u4EE4\u5728\u5168\u5C40\u751F\u6548, \u7136\u540E\u4F7F\u7528 <code>orm --help</code> \u67E5\u770B\u53EF\u7528\u7684\u547D\u4EE4:</p><div class="language-bash"><pre><code><span class="token comment"># todo: add sample</span>
</code></pre></div><p>\u6240\u6709\u7684\u5B50\u547D\u4EE4\u6587\u6863\u4E5F\u53EF\u4EE5\u901A\u8FC7 <code>--help</code> \u67E5\u770B, \u6BD4\u5982 <code>orm init-db --help</code> \u4E0D\u4F1A\u771F\u7684\u6267\u884C\u547D\u4EE4, \u800C\u662F\u6253\u5370\u51FA\u8BE5\u547D\u4EE4\u7684\u5E2E\u52A9\u4FE1\u606F:</p><div class="language-bash"><pre><code><span class="token comment"># todo: add sample</span>
</code></pre></div><h2 id="universal-\u547D\u4EE4" tabindex="-1">universal \u547D\u4EE4 <a class="header-anchor" href="#universal-\u547D\u4EE4" aria-hidden="true">#</a></h2><h3 id="upgrade" tabindex="-1">upgrade <a class="header-anchor" href="#upgrade" aria-hidden="true">#</a></h3><p><code>orm upgrade</code></p><p>\u68C0\u67E5\u5E76\u5347\u7EA7 orm cli \u5230\u6700\u65B0\u7248.</p><h3 id="dumpmodel" tabindex="-1">dumpModel <a class="header-anchor" href="#dumpmodel" aria-hidden="true">#</a></h3><p><code>orm dumpModel &lt;modelDefine&gt;.js</code></p><p>dumpModel \u4F1A\u6253\u5370\u6570\u636E\u5E93\u4FE1\u606F, \u8BE5\u8FC7\u7A0B\u4E2D\u4F1A\u628A\u300C\u7528\u6237\u5B9A\u4E49\u7684 model\u300D\u548C\u300C\u4ECE\u5B9E\u9645\u6570\u636E\u5E93\u62BD\u8C61\u7684 model\u300D\u4E4B\u95F4\u7684 diff \u4E5F\u5199\u5165\u4E3A patch \u6587\u4EF6.</p><p><code>&lt;modelDefine&gt;.js</code> \u88AB\u9884\u671F\u5BFC\u51FA\u4E00\u4E2A\u65B9\u6CD5, \u8BE5\u65B9\u6CD5\u4E2D\u5E94\u4F7F\u7528 ORM \u8FDE\u63A5\u67D0\u4E2A\u6570\u636E\u5E93, \u5E76\u5B9A\u4E49\u4E00\u4E9B\u6570\u636E\u6A21\u578B. \u6839\u636E ORM \u5C5E\u6027\u5B9A\u4E49\u89C4\u8303, dumpModel \u8FC7\u7A0B\u4E2D\u4F1A\u5BF9\u6570\u636E\u5E93\u4E2D\u6BCF\u4E2A\u8868 table \u5C1D\u8BD5\u5EFA\u6A21, \u5F97\u5230\u4E00\u4E9B\u5C5E\u6027\u5B9A\u4E49 <code>dataStoreProperties</code>, \u540C\u65F6\u7528\u6237\u5B9A\u4E49\u7684\u6240\u6709\u5C5E\u6027\u8BB0\u4E3A <code>userDefinedProperties</code>.</p><p>\u4E00\u4E2A\u53C2\u8003\u7684 <code>&lt;modelDefine&gt;.js</code> \u6587\u4EF6\u5982\u4E0B:</p><div class="language-js"><pre><code><span class="token keyword">const</span> modelConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// &quot;connection&quot;: &quot;mysql://root@127.0.0.1/test&quot;,</span>
    <span class="token string-property property">&quot;connection&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sqlite:./tmp/dump-model.db&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 
 * @param {import(&#39;@fxjs/orm/typings/ORM&#39;).ORMInstance} db
 * @param {import(&#39;@fxjs/orm&#39;)} ORM
 */</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token constant">ORM</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token constant">ORM</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>modelConfig<span class="token punctuation">.</span>connection<span class="token punctuation">)</span>

    db<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;integer&#39;</span><span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token number">4</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">orm</span><span class="token operator">:</span> db<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>\u5047\u8BBE\u8BE5\u6587\u4EF6\u8DEF\u5F84\u4E3A <code>/path_to/model-define.js</code>, \u5219 dumpModel \u4F1A\u5B8C\u6210\u5982\u4E0B\u5DE5\u4F5C:</p><ul><li>\u4ECE\u6570\u636E\u5E93\u4E2D\u8BFB\u53D6\u4FE1\u606F, \u5305\u62EC\u8868\u7ED3\u6784, \u5B57\u6BB5\u7C7B\u578B, \u5B57\u6BB5\u540D\u79F0\u7B49\u7B49, \u751F\u6210 <code>/path_to/model-define-dump.json</code> \u6587\u4EF6, \u5305\u542B\u8868\u7ED3\u6784\u4FE1\u606F.</li><li>\u751F\u6210\u4E00\u4E2A <code>/path_to/properties-for-t-[user].patch</code> \u6587\u4EF6, \u8868\u793A <code>dataStoreProperties</code> \u548C <code>userDefinedProperties</code> \u7684\u5DEE\u5F02</li></ul><p>\u5728\u6267\u884C\u5B8C dumpModel \u540E \u8FD9\u4E9B\u4FE1\u606F\u4F1A\u88AB\u4FDD\u5B58\u5230 <code>&lt;modelDefine&gt;.js</code> \u540C\u76EE\u5F55\u4E0B\u7684 <code>&lt;modelDefine&gt;-dump.json</code> \u6587\u4EF6\u4E2D.</p><p><strong>\u9009\u9879</strong></p><ul><li><code>--sync</code>: \u662F\u5426\u5C06\u7528\u6237\u5B9A\u4E49\u7684 model \u540C\u6B65\u5230\u6570\u636E\u5E93\u8868\u7ED3\u6784\u4E2D.</li><li><code>--no-alphabet</code>: \u7981\u7528\u5728 patch \u65F6\u5C06\u6BCF\u4E2A property \u5B9A\u4E49\u6309\u5B57\u6BCD\u987A\u5E8F\u6392\u5E8F.</li></ul>`,24);function _(f,y,v,b,x,M){const s=l("Badge");return r(),o("div",null,[a("h1",i,[u,t(s,{type:"warning"},{default:p(()=>[k]),_:1}),m,h]),g])}var D=e(d,[["render",_]]);export{q as __pageData,D as default};
